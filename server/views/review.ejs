<!DOCTYPE html>
<html>
<head>
    <link type="text/css" rel="stylesheet" href="style.css" />
</head>
<body>

    <div id="kanjiHolder">
        <div id="navHolder">
            <a id="reviewHomeHref" href="/">Home</a>
            <p id="remainingCounter">0</p>
        </div>

        <div id="kanjiTextHolder">
            <p id="kanji">shouldnotbehere</p>
        </div>
    </div>

    <hr id="reviewSeparation">

    <div id="buttonHolder">
        <input type="button" id="incorrectButton" class="wideButton" value="Incorrect" />
        <input type="button" id="correctButton" class="wideButton" value="Correct" />

        <form id="reviewForm" action="/reviewEnd" method="post">
            <input id="reviewInput" type="hidden" name="reviewList" value="">
        </form>
    </div>

    <div id="infoHolder">
        <details id="vocabInfo">
            <summary>Info</summary>
            <p id="meaningInfo">meaningText</p>
            <p id="readingInfo">readingText</p>
        </details>
    </div>

    <script>
        document.getElementById("incorrectButton").addEventListener("click", incorrect, false);
        document.getElementById("correctButton").addEventListener("click", correct, false);

        document.body.addEventListener("keydown", keyShortcuts, false);

        // formatting often puts spaces between %% which creates syntax error
        var reviewList = <%-JSON.stringify(reviewList)%>

        var reviewRemainingCount = reviewList.length;

        // change initial remaining review count
        document.getElementById("remainingCounter").innerHTML = reviewRemainingCount;

        // change initial kanji
        document.getElementById("kanji").innerHTML = reviewList[0].kanji
        document.getElementById("meaningInfo").innerHTML = reviewList[0].meaning
        document.getElementById("readingInfo").innerHTML = reviewList[0].reading

        // hashmap creation
        const fourhours = 1000 * 60 * 60 * 4
        const eighthours = 1000 * 60 * 60 * 4
        const oneday = 1000 * 60 * 60 * 24
        const twodays = 1000 * 60 * 60 * 24 * 2
        const oneweek = 1000 * 60 * 60 * 24 * 7
        const twoweeks = 1000 * 60 * 60 * 24 * 7 * 2
        const fourmonths = 10512000000

        const stageTimesMap = new Map();
        stageTimesMap.set(0, fourhours);
        stageTimesMap.set(1, eighthours);
        stageTimesMap.set(2, oneday);
        stageTimesMap.set(3, twodays);
        stageTimesMap.set(4, oneweek);
        stageTimesMap.set(5, twoweeks);
        stageTimesMap.set(6, fourmonths);
        //

        i = 0

        function changeKanji() {
            if (i + 1 === reviewList.length) {
                document.getElementById("reviewInput").value = JSON.stringify(reviewList);
                document.getElementById("reviewForm").submit();
            }
            else {
                i += 1

                // replace counter with remaining review count
                reviewRemainingCount -= 1
                document.getElementById("remainingCounter").innerHTML = reviewRemainingCount;

                // replace kanji
                document.getElementById("kanji").innerHTML = reviewList[i].kanji
                document.getElementById("meaningInfo").innerHTML = reviewList[i].meaning
                document.getElementById("readingInfo").innerHTML = reviewList[i].reading

                // close details info
                document.getElementById("vocabInfo").removeAttribute("open");
            }
        }
        function incorrect() {
            changeKanji()
        }
        function correct() {
            // set the next time to review
            currentTime = new Date().getTime();
            var nextTime = stageTimesMap.get(parseInt(reviewList[i].stage))

            reviewList[i].nextReviewTime = currentTime + nextTime
            //

            reviewList[i].stage += 1

            changeKanji()
        }
        function keyShortcuts(event) {
            console.log(event.key)
            // minus key shortcut, incorrect, shift with minus gives underscore for event.key
            if (event.key === "_") {
                incorrect();
            }
            // plus key shortcut, correct
            else if (event.key === "+") {
                correct();
            }
            // left bracket shortcut, close details info
            else if (event.key === "{") {
                document.getElementById("vocabInfo").open = true;
            }
        }
    </script>

</body>
</html>